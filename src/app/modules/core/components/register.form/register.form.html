<div class="register-container">
  <mat-card class="register-card">

    <mat-card-header class="register-header">
      <mat-card-title>Stwórz nowe konto</mat-card-title>
      <mat-card-subtitle>Dołącz do nas i znajdź pracę marzeń</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="registerForm" (ngSubmit)="onRegister()">

        <!-- Pole Email -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" placeholder="przyklad@email.com" autocomplete="username">
          <mat-icon matSuffix>email</mat-icon>

          @if (email?.invalid && (email?.dirty || email?.touched)) {
            @if (email?.hasError('required')) {
              <mat-error>Email jest wymagany</mat-error>
            }
            @if (email?.hasError('email')) {
              <mat-error>Niepoprawny format emaila</mat-error>
            }
          }
        </mat-form-field>

        <!-- Pole Hasło -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Hasło</mat-label>
          <input
            matInput
            [type]="hidePassword() ? 'password' : 'text'"
            formControlName="password"
            autocomplete="new-password">

          <button mat-icon-button matSuffix (click)="togglePassword($event)" type="button">
            <mat-icon>{{hidePassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>

          <!-- Szczegółowa Walidacja Hasła -->
          @if (password?.invalid && (password?.dirty || password?.touched)) {
            @if (password?.hasError('required')) {
              <mat-error>Hasło jest wymagane</mat-error>
            }
            @if (password?.hasError('minlength')) {
              <mat-error>Minimum 8 znaków</mat-error>
            }
            @if (password?.hasError('maxlength')) {
              <mat-error>Maksimum 16 znaków</mat-error>
            }
            @if (password?.hasError('pattern')) {
              <mat-error>Wymagana mała i duża litera oraz cyfra</mat-error>
            }
          }
        </mat-form-field>

        <!-- Pole Powtórz Hasło -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Powtórz hasło</mat-label>
          <input
            matInput
            [type]="hideConfirmPassword() ? 'password' : 'text'"
            formControlName="confirmPassword"
            autocomplete="new-password">

          <button mat-icon-button matSuffix (click)="toggleConfirmPassword($event)" type="button">
            <mat-icon>{{hideConfirmPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>

          <!-- Walidacja zgodności haseł -->
          @if (registerForm.hasError('mismatch') && (confirmPassword?.dirty || confirmPassword?.touched)) {
            <mat-error>Hasła nie są identyczne</mat-error>
          }
        </mat-form-field>

        <!-- Przycisk Rejestracji -->
        <div class="actions">
          <button
            mat-flat-button
            color="primary"
            type="submit"
            class="register-btn"
            [disabled]="registerForm.invalid || isLoading">
            @if (isLoading) { Rejestrowanie... } @else { Zarejestruj się }
          </button>
        </div>

      </form>
    </mat-card-content>

    <mat-card-footer class="register-footer">
      <p>Masz już konto? <a routerLink="/logowanie">Zaloguj się</a></p>
    </mat-card-footer>

  </mat-card>
</div>
